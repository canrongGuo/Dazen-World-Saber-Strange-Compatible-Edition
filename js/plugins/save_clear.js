window.onload=function(){alert("作者:Cat");alert("重要:本程序会自动精简file1.rpgsave, 请自行备份好存档再开始");alert("重要:本程序比较蠢, 只会处理file1.rpgsave, 如果这个档位没有存档, 本程序也不会报错");alert("开始载入存档文件file1.rpgsave");var a=load(1);alert("开始清理多余的武器数据.....");clearWeapon(a);alert("开始清理多余的防具数据.....");clearArmor(a);alert("开始保存瘦身后的文件.....");save(a,1);alert("保存成功.....文件名:file1.rpgsave 你可以关闭这个窗口了")};function clearArmor(f){var h=0;var k=f.armors;var c=f.party;var d=f.actors;for(var g=0;g<k.length;g++){if(k[g]){var a=false;for(var e=0;e<c._actors.length;e++){if(hasArmor(d._data[c._actors[e]],k[g].id)){a=true;break}}if(!a){for(var b in c._armors){if(k[g].id==b){a=true;break}}}if(!a){h++;k[g]=null}}}alert("成功清理掉了"+h+"件防具数据")}function hasArmor(b,c){for(var a=0;a<b._equips.length;a++){if(b._equips[a]._dataClass!="weapon"&&b._equips[a]._itemId==c){return true}}return false}function hasWeapon(b,c){for(var a=0;a<b._equips.length;a++){if(b._equips[a]._dataClass=="weapon"&&b._equips[a]._itemId==c){return true}}return false}function clearWeapon(f){var h=0;var k=f.weapons;var c=f.party;var d=f.actors;for(var g=0;g<k.length;g++){if(k[g]){var a=false;for(var e=0;e<c._actors.length;e++){if(hasWeapon(d._data[c._actors[e]],k[g].id)){a=true;break}}if(!a){for(var b in c._weapons){if(k[g].id==b){a=true;break}}}if(!a){h++;k[g]=null}}}alert("成功清理掉了"+h+"件武器数据")}function save(d,b){var a=require("fs");var c=localFilePath(b);a.writeFileSync(c,LZString.compressToBase64(JsonEx.stringify(d)))}function load(a){return JsonEx.parse(loadFromLocalFile(a))}function loadFromLocalFile(b){var d=null;var a=require("fs");var c=localFilePath(b);if(a.existsSync(c)){d=a.readFileSync(c,{encoding:"utf8"})}return LZString.decompressFromBase64(d)}function localFilePath(a){var c=require("path");var b=c.dirname(process.mainModule.filename);return c.join(b,"../save/")+"file%1.rpgsave".format(a)};